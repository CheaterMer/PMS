# 최근 변경 내역

## 1. 알람 자동 새로고침 기능 개선
- **자동 새로고침 로직**: 주기적인 알람 스캔 메커니즘(`startAutoAlarmInterval`)을 검증하고 확인했습니다.
- **토글 지원**: 내부 `autoAlarm` 설정값에 따라 기능이 올바르게 켜지고 꺼지도록 수정했습니다.

## 2. 시스템 알림(윈도우 팝업) 기능 강화
- **새로운 제어 옵션 추가**: **TM설정 > 편의기능** 탭에 "윈도우(시스템) 알림 사용" 체크박스를 추가했습니다.
  - 이제 사용자가 브라우저 자체 알림(HTML 토스트)과 윈도우 시스템 알림 중 명확하게 선택할 수 있습니다.
- **테스트 기능**: 브라우저 권한 및 알림 표시 여부를 확인할 수 있는 "테스트 알림" 버튼을 추가했습니다.
- **권한 관리**: 브라우저에서 알림이 차단된 경우 사용자에게 경고 메시지를 표시하여 설정을 유도하도록 개선했습니다.
- **상호작용 알림**: 윈도우 시스템 알림 클릭 시 해당 알람 이벤트의 상세 페이지로 자동 이동하는 기능을 구현했습니다.

## 3. 알람 로직 최적화
- **중복 방지**: `Set` 자료구조를 활용한 알람 추적 시스템을 구현했습니다.
  - 동일한 알람 이벤트가 반복적으로 알림을 발생시키는 것을 방지합니다.
  - 알람 텍스트와 ID를 조합하여 고유한 알람을 식별합니다.

## 4. UI 정리
- **변경 이력 패널 삭제**: 주차 요금 정보 모달에서 "최근 변경 이력"(`MshowPlateHistory`) 패널을 완전히 제거했습니다. (입차 사진 표시와 기능이 중복되어 불필요함)


# TM 주차 관제 시스템 기능 설명서

이 문서는 TM 주차 관제 시스템 확장 스크립트(`newtime.js`)의 주요 기능과 설정 방법을 설명합니다.

## 1. TM 설정 (기본 설정)
화면 우측 하단의 **TM설정** 패널에서 각 기능을 켜고 끌 수 있습니다.

### 편의 기능
- **입차사진 표시**: 주차 목록에서 차량 정보를 확인할 때, 해당 차량의 입차 사진 패널을 화면에 표시합니다.
- **다크 모드**: 화면 전체를 어두운 테마로 변경하여 눈의 피로를 줄입니다.
- **상태 강조**: 주차 목록의 상태(미납, 정상, 무료 등)에 따라 행의 배경색을 강조하여 구분하기 쉽게 합니다.
- **이미지 팝업 사용**: 입차/출차 이미지를 클릭했을 때 확대된 팝업창을 띄웁니다.
- **번호판 수정 사용**: 번호판 인식 오류 시, 번호를 직접 수정할 수 있는 기능을 활성화합니다.
- **번호 변경 시 자동할인 적용**: 번호판을 수정했을 때, 미리 설정된 할인(예: 10분 무료 등)을 자동으로 적용합니다.
- **10분 처리 버튼 표시**: 요금 정산 화면 등에서 차량을 '10분 무료' 처리할 수 있는 단축 버튼을 표시합니다.
- **미납 처리 모드**: 미납 차량 관리에 최적화된 화면 모드(테이블 너비 조정 등)를 사용합니다.
- **행 클릭 시 요금페이지 이동**: 주차 목록의 행을 클릭하면 즉시 해당 차량의 요금 정산 페이지로 이동합니다.

### 알람 및 알림
- **알람 자동 새로고침**: 새로운 알람이 있는지 주기적으로 확인하여 목록을 갱신합니다.
  - **간격**: 3초 ~ 60초 사이에서 새로고침 주기를 설정할 수 있습니다.
- **윈도우(시스템) 알림 사용**: 브라우저가 백그라운드에 있어도 윈도우 바탕화면 우측 하단에 알림 메시지를 띄웁니다. (권한 허용 필요)
- **사이드바 알람 모드**: 알람 목록을 화면 우측에 고정된 사이드바 형태로 항상 표시합니다.
- **디버그 모드 사용 (로그 출력)**: 개발자 도구(F12) 콘솔에 동작 로그를 출력합니다. 문제 해결 시에만 켜두는 것이 좋습니다.

## 2. 알람 기능 상세
- **알람 유지**: 한번 확인한 알람도 목록에서 즉시 사라지지 않고 유지되어, 나중에 다시 확인할 수 있습니다.
- **알람 삭제(완료)**: 알람 항목 우측의 `X` 버튼을 누르면 완료 처리되며 목록에서 즉시 제거됩니다.
- **알람 이동**: 알람 내용을 클릭하면 해당 이벤트(입차/출차/정산)가 발생한 상세 페이지로 이동합니다.

## 3. 기타 유틸리티
- **ESC 키 닫기**: 이미지 팝업이나 요금 정산 창 등 열려있는 팝업창을 `ESC` 키를 눌러 간편하게 닫을 수 있습니다.
- **사이드바 토글**: 화면 좌측의 기본 메뉴 사이드바를 접거나 펼쳐서 작업 공간을 넓게 쓸 수 있습니다.
